---
title: "EDA"
author: "Team 23"
date: "`r Sys.Date()`"
output: pdf_document
---

# Cleaning and EDA for group_standings.csv dataset

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Install req text
source("00_requirements.R")

# import cleaning function
source("clean_group_standings.R")
```

```{r}
df_group_standings <- clean_group_standings("group_standings.csv")

head(df_group_standings, 200)
```



```{r}


# creating new column to store labels
df_group_standings$is_winner <- 0

years <- unique(df_group_standings$year) # finding all unique WC years

# going through each year, finding team with highest points
for (i in 1:length(years)) {
  
  data_year <- df_group_standings[df_group_standings$year == years[i], ]
  
  max_points <- max(data_year$points)
  
  same_points <- data_year[data_year$points == max_points, ]
 
   # if tie, then use goal difference
  if (nrow(same_points) > 1) {
    max_gd <- max(same_points$goal_difference)
    same_points <- same_points[same_points$goal_difference == max_gd, ]
    
  }
 
   # labeling whichever team as winner for that year
  df_group_standings$is_winner[df_group_standings$team_name == same_points$team_name & 
                                 df_group_standings$year == years[i]] <- 1
  
}

# frequency table with counts
winner_table <- table(df_group_standings$is_winner)
names(winner_table) <- c("Not Winner(0)", "Winner(1)")
winner_table

```

```{r}

# data frame showing which teams were winners each year
winner_list <- df_group_standings[df_group_standings$is_winner == 1,
                                  c("year", "team_name", "points", "goal_difference")]
winner_list <- winner_list[order(winner_list$year), ]

winner_list

```


```{r}

head(df_group_standings)

```

## Exploratory Data Analysis (visualizations)

### Relationship between goals scored and points
```{r}
plot(jitter(df_group_standings$goals_for),
     jitter(df_group_standings$points),
     xlab = "Goals Scored",
     ylab = "Points Earned",
     main = "Relationship between goals scored and points",
     pch = 1)

model <- lm(points ~ goals_for, data = df_group_standings)
abline(model, col="blue")
```

#### Analysis 

This graph plots the relationship between goals scored and points throughout the tournament(s), and there exists an expectation; teams that score more goals will tend to earn more points. Thus, given this plot gives a positive linear relationship the plot behaves as an initial sanity check of the dataset. Looking into the graph, we can see that most teams score less than 10 goals scored throughout the tournament, suggesting the majority of the teams have a strong defense or the games are low-scoring (a hypothesis worth exploring further). Additionally, a large cluster of teams is around the 4 points and less than 5 goals scored, this shows us that majority of teams do not advance far into the tournament. Conversely, teams outside these ranges like correspond to teams progressing to the later stages of the tournament, which can be an invaluable trend that can help towards predicting future games.
